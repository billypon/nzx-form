form(nz-form, [nzLayout]="formLayout", (ngSubmit)="submitForm()")
  ng-container(*ngTemplateOutlet="formTpl; context: { group: formGroup, field: formField }")
  ng-content

ng-template(#formTpl let-group="group" let-field="field")
  ng-container(*ngFor="let name of group.controls | keys")
    ng-container(*ngIf="!group.controls[name].controls")
      ng-container(*ngTemplateOutlet="itemTpl; context: { name: name, group: group, control: group.controls[name], field: field[name], addition: field[name].addition }")
    .form-group(*ngIf="group.controls[name].controls")
      .form-group-caption {{ groupLabel[name] || name }}
      ng-container(*ngTemplateOutlet="formTpl; context: { group: group.controls[name], field: field[name] }")

ng-template(#itemTpl let-name="name" let-group="group" let-control="control" let-field="field" let-addition="addition")
  nz-form-item([formGroup]="group", *ngIf="!field.template && field.type != 'hidden'")
    nz-form-label([nzRequired]="field.required", [ngClass]="{ 'has-error': control.invalid && (control.touched || control.dirty) }") {{ field.type != 'checkbox' ? field.label : '' }}
    nz-form-control([ngSwitch]="field.type")
      nz-form-text(*ngSwitchCase="'text'") {{ group.value[name] }}
      nz-select([formControlName]="name", [nzPlaceHolder]="field.placeholder", (nzBlur)="updateValidity(control)",  (nzOpenChange)="!$event ? updateValidity(control) : 0", *ngSwitchCase="'select'")
        nz-option([nzLabel]="option.label || option.name", [nzValue]="option.value || option.id", *ngFor="let option of addition.data")
      ng-container(*ngSwitchCase="'number'")
        nz-input-number([formControlName]="name", (nzBlur)="updateValidity(control)", *ngIf="!addition.format")
        nz-input-number([formControlName]="name", [nzFormatter]="addition.format", (nzBlur)="updateValidity(control)", *ngIf="addition.format")
      label(nz-checkbox, [formControlName]="name", *ngSwitchCase="'checkbox'") {{ field.label }}
      ng-container(*ngSwitchCase="'datetime'")
        nz-range-picker([formControlName]="name", [nzFormat]="addition.format", [nzShowTime]="field.subtype.includes('time')", *ngIf="[ 'date-range', 'datetime-range' ].includes(field.subtype)")
      ng-container(*ngSwitchDefault)
        textarea(nz-input, [formControlName]="name", [placeholder]="field.placeholder", (blur)="updateValidity(control)", *ngIf="addition.multiline")
        ng-container(*ngIf="!addition.multiline")
          ng-container(*ngIf="!addition.suffix")
            input(nz-input, [formControlName]="name", [placeholder]="field.placeholder", [type]="field.subtype", (blur)="updateValidity(control)", *ngIf="!addition.tooltip")
            input(nz-input, [formControlName]="name", [placeholder]="field.placeholder", [type]="field.subtype", (blur)="updateValidity(control)" nz-tooltip, [nzTitle]="addition.tooltip.title || addition.tooltip", [nzTrigger]="addition.tooltip.trigger || 'focus'" nzPlacement="right", *ngIf="addition.tooltip")
          nz-input-group([nzAddOnAfter]="addition.suffix", *ngIf="addition.suffix")
            input(nz-input, [formControlName]="name", [placeholder]="field.placeholder", [type]="field.subtype", (blur)="updateValidity(control)")
      nz-form-extra(*ngIf="!field.controlError || !field.errors[field.controlError]") {{ field.extra }}
      nz-form-explain(*ngIf="field.controlError && field.errors[field.controlError]") {{ field.errors[field.controlError] }}
  ng-container(*ngIf="field.template")
    ng-container(*ngTemplateOutlet="field.template; context: { name: name, group: group, field: field }")
